<%@page import="java.util.Date"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://www.springframework.org/security/tags"
	prefix="sec"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<%-- <%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%> --%>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>메디폼 │ 의사</title>
<style type="text/css">
.pointer {
	cursor: pointer;
}

.professor-text {
	height: 100%;
}
</style>
</head>
<body>
	<div class="row" style="height: 900px;">
		<div class="col-2">
			<div class="card border border-secondary">
				<div class="">
					<div class="form-control"
						style="background-color: midnightblue; height: 810px;">
						<h4 class="fw-semi-bold col-12 text-white text-center pt-2">${clinicNo }
							진 료 실</h4>
						<h6 class="col-12 text-white text-center">
							담 당 의 사 | <span id="empNo" data-empno="${empVO.empNo }">${empVO.empNm }</span><span
								style="font-size: small; white-space: nowrap; font-weight: nomal;">
								교수</span>
						</h6>
						<hr />
						<div class="card border border-secondary">
							<div>
								<ul class="nav nav-tabs" id="myTab" role="tablist">
									<li class="nav-item text-center col-6"><a
										class="nav-link active fw-semi-bold" id="waiting-tab"
										data-bs-toggle="tab" href="#tab-waiting" role="tab"
										aria-controls="tab-waiting" aria-selected="true">진료대기</a></li>
									<li class="nav-item text-center col-6"><a
										class="nav-link fw-semi-bold" id="done-tab"
										data-bs-toggle="tab" href="#tab-done" role="tab"
										aria-controls="tab-done" aria-selected="false">진료완료</a></li>
								</ul>
							</div>
							<div>
								<div class="row card-body" style="padding: 0px; height: 650px;">
									<div class="tab-content" id="myTabContent">

										<!-- 진료대기 탭 시작 -->
										<div class="col-12 tab-pane fade show active p-0"
											id="tab-waiting" role="tabpanel"
											aria-labelledby="waiting-tab">
											<div class="col-12"
												style="display: flex; justify-content: flex-end;">
												<!-- 										<button class="btn btn-sm btn-falcon-primary" id="waitingBtn"> -->
												<!-- 											<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-clockwise" viewBox="0 0 16 16"> -->
												<!-- 												<path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"></path> -->
												<!-- 												<path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"></path> -->
												<!-- 											</svg> -->
												<!-- 										</button> -->
											</div>
											<div class="list bg-body-tertiary d-flex flex-column gap-1 "
												id="waitingList"
												style="overflow-y: auto; max-height: 600px;">
												<!-- 내용 ajax 비동기 생성 -->
											</div>
										</div>
										<!-- 진료대기 탭 끝 -->

										<!-- 진료완료 탭 시작 -->
										<div class="col-12 tab-pane fade" id="tab-done"
											role="tabpanel" aria-labelledby="done-tab">
											<div class="list bg-body-tertiary d-flex flex-column gap-1 "
												id="doneClinicList"
												style="overflow-y: auto; max-height: 600px;">
												<!-- 										<div class="col-12" style="display: flex; justify-content: flex-end;"> -->
												<!-- 											<button class="btn btn-sm btn-falcon-primary" id="doneClinicBtn"> -->
												<!-- 												<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-clockwise" viewBox="0 0 16 16"> -->
												<!-- 													<path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"></path> -->
												<!-- 													<path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"></path> -->
												<!-- 												</svg> -->
												<!-- 											</button> -->
												<!-- 										</div> -->
												<!-- 내용 ajax 비동기 생성 -->
											</div>
										</div>
										<!-- 진료완료 탭 끝 -->

									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="col-3" style="padding-left: 0px;">
			<div class="card border border-secondary">
				<div class="">
					<input
						class="fw-semi-bold col-12 text-white text-center form-control"
						 name="" type="text" value="환자"
						style="background-color: midnightblue" disabled />
						<div id="">
							<input type="hidden" id="patient" value="">
						</div>
				</div>
				<div></div>
			</div>
		</div>

		<!-- 진료 작성  시작-------------------------------------------------------->
		<div class="col-5" style="padding-left: 0px;">
			<div class="card border border-secondary">
				<div class="">
					<div class="form-control"
						style="background-color: midnightblue; height: 810px;">
						<input
							class="fw-semi-bold col-12 text-white text-center form-control"
							id="clinic" name="" type="text" value="진료작성"
							style="background-color: midnightblue" disabled />
<!--진료 시작================================ 진료  시작========================================================= -->
						<p class="fw-semi-bold text-white align-middle"
							style="margin-bottom: 0; vertical-align: center;">
							<input type="hidden" id="rceptNo" value="">
							<span>진료 </span> [
							<input type="hidden" id="clnicTime" value="">
							<span id="clnicTimeText" ></span>
							]
							<span id="hsptlzAtText" class="pointer">입원 </span><input type="checkbox" class="pointer" id="hsptlzAt" value="Y">
							<button type="button" id="clnicInsertBtn" class="btn btn-success me-1 mb-1">임의로 만든 등록버튼</button>
						</p>
						
						<textarea class="card border border-secondary w-100" id="clnicCn"
							style="border-radius: 5px;" rows="3" cols=""></textarea>
<!--진료 끝 ================================ 진료 끝 ========================================================= -->

<!--상병 시작 =============================== 상병 시작=================================================================== -->
						<p class="fw-semi-bold text-white align-middle" style="margin-bottom:0; vertical-align: center;">상병</p>
						<div class="card border border-secondary scrollbar-overlay w-90" style="height:300px; margin-top:0; background-color: white;">
						<!-- 상병 오더 리스트 테이블 시작----------------------->
								<div>
									<table class="table p-0 mb-0 w-100" id="sawlCheckTable">
										<thead class="bg-200" >
											 <tr class="row">
									            <th class="col-1 p-0 align-middle white-space-nowrap" style="text-align: center;">
									              <div class="form-check mb-0">
									                <input id="sawlCheckTh" class="form-check-input" type="checkbox"/>
									              </div>
									            </th>
									            <th class="col-2 p-0 text-black dark__text-white align-middle">질병분류기호</th>
									            <th class="col-3 p-0 text-black dark__text-white align-middle">한글명 </th>
									            <th class="col-3 p-0 text-black dark__text-white align-middle">영문명</th>
									            <th class="col-2 p-0 text-black dark__text-white align-middle">주상병구분</th>
									            <th class="col-1 p-0 text-black dark__text-white align-middle"> 
									            	<button id="sawlAllDelBtn" class="btn btn-outline-danger me-1 mb-1" type="button">삭제</button>
									            </th>
									          </tr>
										</thead>
										<tbody class="sawlInsertTable">

										</tbody>
									</table>
								</div>
								<!-- 상병 오더 리스트 테이블 끝----------------------->
								<!--겅색창 div 시작------------------------------------------------------------>
								<div>
									<div class="search-box w-100" id="sawlSearchBox">
										<form class="position-relative" data-bs-toggle="search" data-bs-display="static">
											<input class="form-control search-input sawlInput" type="search" placeholder="검사코드 및 검사명을 입력해주세요." aria-label="Search" />
											<span class="fas fa-search search-box-icon"></span>
									 	</form>
									 	<div class="btn-close-falcon-container position-absolute end-0 top-50 translate-middle shadow-none" data-bs-dismiss="search">
											<button class="btn btn-link btn-close-falcon p-0" aria-label="Close"></button>
										</div>
										<div class="dropdown-menu border font-base start-0 mt-2 py-0 overflow-hidden w-100" id="sawlDropMenu">
		    								<div id="sawlMenu"  class="scrollbar list py-3" style="max-height: 24rem;">
		    									<div class="d-flex align-items-center">
		    										<table class="w-100 text-center table-sm">
		    											<thead>
		    												<tr class="row dropdown-header text-black text-center">
		    													<th class="col-3">질병분류기호</th>
		    													<th class="col-3">한글명</th>
		    													<th class="col-4">영문명</th>
		    													<th class="col-2">주상병구분</th>
		    												</tr>
		    											</thead>
		    											<tbody id="sawlTbody" class="list text-black">

		    											</tbody>

		    										</table>
										        </div>
		    								</div>
		    							</div>
									</div>
								</div>
								<!--겅색창 div 끝------------------------------------------------------------>
							</div>
<!--상병 끝 =============================== 상병 끝=================================================================== -->

<!--검사 시작 =============================== 검사 시작 =================================================================== -->
						<p class="fw-semi-bold text-white align-middle" style="margin-bottom: 0; vertical-align: center;">
							<span>검사</span> <button id="hcOrderBtn" class="btn btn-success me-1 mb-1">검사 오더 등록</button>
						</p>
						<div class="card border border-secondary scrollbar-overlay" style="height: 300px; margin-top: 0; background-color: white;">
								<!-- 검사 오더 리스트 테이블 시작----------------------->
								<div>
									<table class="table mb-0 w-100" id="hcCheckTable">
										<thead class="bg-200 w-100" >
											 <tr class="row">
									            <th class="col-1 align-middle white-space-nowrap">
									              <div class="form-check mb-0">
									                <input id="hcCheckTh" class="form-check-input" type="checkbox"/>
									              </div>
									            </th>
									            <th class="col-3 text-black dark__text-white align-middle">검사코드</th>
									            <th class="col-3 text-black dark__text-white align-middle">검사명 </th>
									            <th class="col-3 text-black dark__text-white align-middle">급여여부</th>
									            <th class="col-2 text-black dark__text-white align-middle"> 
									            	<button id="hcAllDelBtn" class="btn btn-outline-danger me-1 mb-1" type="button">삭제</button>
									            </th>
									          </tr>
										</thead>
										<tbody class="hcInsertTable">

										</tbody>
									</table>
								</div>
								<!-- 검사 오더 리스트 테이블 끝----------------------->
								<!--겅색창 div 시작------------------------------------------------------------>
								<div>
									<div class="search-box w-100" id="hcSearchBox" data-list='{"valueNames":["hlthchkpNm"]}' >
										<form class="position-relative" data-bs-toggle="search" data-bs-display="static">
											<input class="form-control search-input hCInput" type="search" placeholder="검사코드 및 검사명을 입력해주세요." aria-label="Search" />
											<span class="fas fa-search search-box-icon"></span>
									 	</form>
									 	<div class="btn-close-falcon-container position-absolute end-0 top-50 translate-middle shadow-none" data-bs-dismiss="search">
											<button class="btn btn-link btn-close-falcon p-0" aria-label="Close"></button>
										</div>
										<div class="dropdown-menu border font-base start-0 mt-2 py-0 overflow-hidden w-100" id="hcDropMenu">
		    								<div id="hcMenu"  class="scrollbar list py-3" style="max-height: 24rem;">
		    									<div class="d-flex align-items-center">
		    										<table class="w-100 text-center">
		    											<thead>
		    												<tr class="row dropdown-header text-black text-center">
		    													<th class="col-3">검사코드</th>
		    													<th class="col-7">검사명</th>
		    													<th class="col-2">급여여부</th>
		    												</tr>
		    											</thead>
		    											<tbody id="hCTbody" class="list text-black">

		    											</tbody>

		    										</table>
										        </div>
		    								</div>
		    							</div>
									</div>
								</div>
								<!--겅색창 div 끝------------------------------------------------------------>
							</div>
<!--검사 끝 =============================== 검사 끝 =================================================================== -->

<!--치료 시작 =============================== 치료 시작 =================================================================== -->
							<p class="fw-semi-bold text-white align-middle"
								style="margin-bottom: 0; vertical-align: center;">치료</p>
							<div class="card border border-secondary scrollbar-overlay" style="height: 300px; margin-top: 0; background-color: white;">
								<!-- 치료 오더 리스트 테이블 시작----------------------->
								<div>
									<table class="table mb-0 w-100" id="mtCheckTable">
										<thead class="bg-200 w-100" >
											 <tr class="row">
									            <th class="col-1 align-middle white-space-nowrap">
									              <div class="form-check mb-0">
									                <input id="mtCheckTh" class="form-check-input" type="checkbox"/>
									              </div>
									            </th>
									            <th class="col-3 text-black dark__text-white align-middle">치료코드</th>
									            <th class="col-3 text-black dark__text-white align-middle">치료명 </th>
									            <th class="col-3 text-black dark__text-white align-middle">급여여부</th>
									            <th class="col-2 text-black dark__text-white align-middle"> 
									            	<button id="mtAllDelBtn" class="btn btn-outline-danger me-1 mb-1" type="button">삭제</button>
									            </th>
									          </tr>
										</thead>
										<tbody class="mtInsertTable">
										</tbody>
									</table>
								</div>
								<!-- 치료 오더 리스트 테이블 끝----------------------->
								<!--치료 div 시작------------------------------------------------------------>
								<div>
									<div class="search-box w-100" id="mtSearchBox">
										<form class="position-relative" data-bs-toggle="search" data-bs-display="static">
											<input class="form-control search-input mtInput" type="search" placeholder="치료코드 및 치료명을 입력해주세요." aria-label="Search" />
											<span class="fas fa-search search-box-icon"></span>
									 	</form>
									 	<div class="btn-close-falcon-container position-absolute end-0 top-50 translate-middle shadow-none" data-bs-dismiss="search">
											<button class="btn btn-link btn-close-falcon p-0" aria-label="Close"></button>
										</div>
										<div class="dropdown-menu border font-base start-0 mt-2 py-0 overflow-hidden w-100" id="mtDropMenu">
		    								<div id="mtMenu"  class="scrollbar list py-3" style="max-height: 24rem;">
		    									<div class="d-flex align-items-center">
		    										<table class="w-100 text-center">
		    											<thead>
		    												<tr class="row dropdown-header text-black text-center">
		    													<th class="col-3">치료코드</th>
		    													<th class="col-7">치료명</th>
		    													<th class="col-2">급여여부</th>
		    												</tr>
		    											</thead>
		    											<tbody id="mtTbody" class="list text-black">

		    											</tbody>
		    										</table>
										        </div>
		    								</div>
		    							</div>
									</div>
								</div>
								<!--치료 div 끝------------------------------------------------------------>
<!--치료 끝 =============================== 치료 끝 =================================================================== -->
<!--처방 시작 =============================== 처방 시작 =================================================================== -->
								<p class="fw-semi-bold text-white align-middle" style="margin-bottom: 0; vertical-align: center;">처방</p>
								<!-- 처방 오더 리스트 테이블 시작 ------------------------------------------------->
								<div class="">
									<table class="table mb-0 w-100" id="mCheckTable">
										<thead class="bg-200 w-100" >
											 <tr class="row">
									            <th class="col-1 p-0 align-middle white-space-nowrap">
									              <div class="form-check mb-0">
									                <input id="mCheckTh" class="form-check-input" type="checkbox"/>
									              </div>
									            </th>
									            <th class="col-2 p-0 text-black dark__text-white align-middle">약품코드</th>
									            <th class="col-2 p-0 text-black dark__text-white align-middle">약품명</th>
									            <th class="col-2 p-0 text-black dark__text-white align-middle">업체명</th>
									            <th class="col-1 p-0 text-black dark__text-white align-middle">투여량</th>
									            <th class="col-1 p-0 text-black dark__text-white align-middle">투여횟수</th>
									            <th class="col-1 p-0 text-black dark__text-white align-middle">투여기간</th>
									            <th class="col-2 p-0 text-black dark__text-white align-middle"> 
									            	<button id="mAllDelBtn" class="btn btn-outline-danger me-1 mb-1" type="button">삭제</button>
									            </th>
									          </tr>
										</thead>
										<tbody class="mInsertTable">
										</tbody>
									</table>
								</div>
								<!-- 처방 오더 리스트 테이블 끝----------------------->
								<!--처방 div 시작------------------------------------------------------------>
								<div>
									<div class="search-box w-100" id="mSearchBox">
										<form class="position-relative" data-bs-toggle="search" data-bs-display="static">
											<input class="form-control search-input mInput" type="search" placeholder="약품코드 및 약품명을 입력해주세요." aria-label="Search" />
											<span class="fas fa-search search-box-icon"></span>
									 	</form>
									 	<div class="btn-close-falcon-container position-absolute end-0 top-50 translate-middle shadow-none" data-bs-dismiss="search">
											<button class="btn btn-link btn-close-falcon p-0" aria-label="Close"></button>
										</div>
										<div class="dropdown-menu border font-base start-0 mt-2 py-0 overflow-hidden w-100" id="mDropMenu">
		    								<div id="mMenu"  class="scrollbar list py-3" style="max-height: 24rem;">
		    									<div class="d-flex align-items-center">
		    										<table class="w-100 text-center">
		    											<thead>
		    												<tr class="row dropdown-header text-black text-center">
		    													<th class="col-2">약품코드</th>
		    													<th class="col-5">약품명</th>
		    													<th class="col-3">업체명</th>
		    													<th class="col-2">투여경로</th>
		    												</tr>
		    											</thead>
		    											<tbody id="mTbody" class="list text-black">

		    											</tbody>
		    										</table>
										        </div>
		    								</div>
		    							</div>
									</div>
								</div>
								<!--처방 div 끝------------------------------------------------------------>
							</div>
<!-- 							<div class="card border border-secondary scrollbar-overlay" -->
<!-- 								style="height: 132px; margin-top: 0; background-color: white;"> -->
<!-- 							</div> -->
<!--처방 끝 =============================== 처방 끝 =================================================================== -->
							
						</div>
					</div>
					<div></div>
				</div>
			</div>
			<!-- 진료 작성  끝-->

			<div class="col-2" style="padding-left: 0px;"
				style="padding-right: 0px;">
				<div class="card border border-secondary">
					<div class="">
						<input
							class="fw-semi-bold col-12 text-white text-center form-control"
							id="groupOrder" name="" type="text" value="그룹오더"
							style="background-color: midnightblue" disabled />
					</div>
					<div></div>
				</div>
			</div>
		</div>

		<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css"> -->
		<!-- <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script> -->
		<meta id="_csrf" name="_csrf" content="${_csrf.token}" />
		<meta id="_csrf_header" name="_csrf_header"
			content="${_csrf.headerName}" />
<script>
var token = $("meta[name='_csrf']").attr("content");
var header = $("meta[name='_csrf_header']").attr("content");

// 진료대기 환자 리스트
$(function(){
	$.ajax({
		type: "get",
		url: "/mediform/doctor/room/list",
		contentType : "application/json; charset=utf-8",
        beforeSend : function(xhr){
        	 xhr.setRequestHeader(header,token);
        },
        success : function(data){
			var waitingList = "";
			console.log(data);
			
        	$.each(data, function(index, item) {
        		var rceptNo = item.rceptVO.rceptNo;						// 접수번호
				var status = item.rceptVO.rceptSttus;					// 상태
				if(status == "0" | status == "1" | status == "3" | status == "4"){
	        		var name = item.patientVO.patntNm;					// 환자명
	        		
					if(status == "0"){
						status = "진료대기";
						color = "primary";
					}else if(status == "1"){
						status = "진료중";
						color = "success";
					}else if(status == "3"){
						status = "검사중";
						color = "warning";
					}else if(status == "4"){
						status = "검사완료";
						color = "primary";
					}
		        	var hlthinsAt = item.patientVO.patntHlthinsAt;		// 건강보험
		        	if(hlthinsAt == "Y"){
		        		hlthinsAt = "보험 유";
					}else{
						hlthinsAt = "보험 무";
					}
					var hsptlzAt = item.patientVO.patntHsptlzAt;
					
					var time = new Date(item.rceptVO.rceptDt);			// 접수 일시
					var hour = time.getHours().toString().padStart(2,'0');
					var minute = time.getMinutes().toString().padStart(2,'0');
					var rcepttime = hour + ":" + minute; 	
					
					var no = item.rceptVO.patntNo;					// 환자 번호
					var birthDay = item.patientVO.patntRrno1.toString()	// 생년월일
					var birth = birthDay.substring(0,2) + "." + birthDay.substring(2,4) + "." + birthDay.substring(4,6);	// 생년월일
					var age = item.patientVO.patntAge;					// 나이
					var gender = item.patientVO.patntSexdstn;			// 성별
					if(gender == "M"){
						gender = "남";
					}else{
						gender = "여";
					}
					var memo = item.rceptVO.rceptReason;				// 내원 이유
					if(memo == "null"){
						memo = " ";
					}
					
					var itemList = "";
					itemList += "<div class='patntWatingCard bg-white dark__bg-1100 d-md-flex d-xl-inline-block d-xxl-flex align-items-center p-3 rounded-3 shadow-sm card-view-height gap-1'>";
					itemList += "<div class='d-flex align-items-start align-items-sm-center'>";
					itemList += "<div class='row align-items-center gx-0 gy-2'>";
					itemList += "<div class='col-auto'>";
					itemList += "<div class='row'>";
					itemList += "<div class='col-7'>";
					itemList += "<span class='fas fa-user' data-fa-transform='shrink-3 up-1'></span>";
					itemList += " <span style='font-weight: bold;'>" + name + "</span>";
					itemList += "</div>";
					itemList += "<div class='col-5' style='padding-right: 10px; display: flex; justify-content: flex-end;'>";
					itemList += "<button class='btn btn-sm btn-outline-" + color + " callbutton' style='padding-right:5px; padding-left:5px; font-size: x-small;' value='" + rceptNo + "'>" + status +"</button>";
					itemList += "</div>";
					itemList += "</div>";
					itemList += "<div class='row' style='font-size: small;'>";
					itemList += "<span class='clickPatntNo'>" + no + " | " + hlthinsAt + " | " + rcepttime + "</span><br/>";
					itemList += "<span>" + birth + " | 만 " + age + "세 | " + gender + "</span>";
					itemList += "</div>";
					itemList += "</div>";
					itemList += "<hr style='margin-bottom: 0px;'/>";
					itemList += "<div class='col-auto'>";
					itemList += "<h6 class='mb-0 text-500 pt-0'>" + memo + "</h6>";
					itemList += "</div>";
					itemList += "</div>";
					itemList += "</div>";
					itemList += "</div>";
					
					waitingList += itemList;
				}
				
        	});
			$("#waitingList").empty().append(waitingList);
        },
        error: function(){
        	alert("서버오류! 다시 시도해주세요.");
        }
	});
	
});

// 진료대기 때 호출 hover
$(document).on('mouseover', '.callbutton:contains("진료대기")', function() {
	$(this).text("호출");
	$(this).css({"font-weight": "bold", "font-size": "small"});
}).on('mouseout', '.callbutton:contains("호출")', function() {
	$(this).text("진료대기");
	$(this).css({"font-weight": "normal", "font-size": "x-small"});
});

// 검사완료 때 호출 hover
$(document).on('mouseover', '.callbutton:contains("검사완료")', function() {
	$(this).text("재호출");
	$(this).css({"font-weight": "bold", "font-size": "small"});
}).on('mouseout', '.callbutton:contains("재호출")', function() {
	$(this).text("검사완료");
	$(this).css({"font-weight": "normal", "font-size": "x-small"});
});

// 호출 버튼 클릭시
$(document).on('click', '.callbutton:contains("호출")', function() {
	var status  = 1;
	
	var clnicTimeText = $("#clnicTimeText");
	var clnicTime = $("#clnicTime");
	var rceptNo = $(this).val();
	var updateObject = {
		rceptNo : rceptNo,
		rceptSttus: status
	}
	var patntInfo = $(this).closest(".patntWatingCard").find(".clickPatntNo").text();
	var patntNo = patntInfo.split(" ", 1);
	console.log("누를 때마다 달라지는지 : " + patntNo);
	console.log(updateObject);
	
	$.ajax({
		type: "post",
		url: "/mediform/doctor/room/update/status",
		data: JSON.stringify(updateObject),
		contentType: "application/json; charset=utf-8",
        beforeSend: function(xhr){
        	 xhr.setRequestHeader(header,token);
        },
        success: function(data){
			console.log(data);
			var clnicStartTime = new Date();
// 			var year = clnicStartTime.getFullYear();     												// 연도
// 		    var month = (clnicStartTime.getMonth() + 1).toString().padStart(2,'0');					// 월
// 		    var day = clnicStartTime.getDate().toString().padStart(2,'0');  							// 일
// 			var hour = clnicStartTime.getHours().toString().padStart(2,'0');							// 시간
// 			var minute = clnicStartTime.getMinutes().toString().padStart(2,'0');						// 분
// 			var clnicTimeFormat = year + "-" + month + "-" + day + " " + hour + ":" + minute;
			var clnicStartTimeFormat = moment(clnicStartTime).format('YYYY년 MM월 DD일 HH:mm');
			console.log("현재 시간 : "+clnicStartTimeFormat);
			$(clnicTimeText).html(clnicStartTimeFormat);
// 			$(clnicTime).val(clnicTimeFormat);
			$("#rceptNo").val(rceptNo);
			$("#patient").val(patntNo);
			
        },
        error: function(){
        	alert("서버오류! 다시 시도해주세요.");	
        }
	});
});
    
// 진료완료 환자 리스트
$(function(){
	$.ajax({
		type: "get",
		url: "/mediform/doctor/room/list",
		contentType : "application/json; charset=utf-8",
        beforeSend : function(xhr){
        	 xhr.setRequestHeader(header,token);
        },
        success : function(data){
			var doneClinicList = "";
			console.log(data);
			
        	$.each(data, function(index, item) {
				var status = item.rceptVO.rceptSttus;					// 상태
				if(status == "2" | status == "5" | status == "7" | status == "8" | status == "9"){
	        		var name = item.patientVO.patntNm;					// 환자명
	        		
	        		if(status == "2"){
						status = "진료완료";
						color = "dark";
					}else if(status == "5"){
						status = "물리치료";
						color = "info";
					}else if(status == "5"){
						status = "물리치료";
						color = "info";
					}else if(status == "7"){
						status = "작업치료";
						color = "info";
					}else if(status == "8"){
						status = "작업치료";
						color = "info";
					}else if(status == "9"){
						status = "수납완료";
						color = "secondary";
					}
		        	var hlthinsAt = item.patientVO.patntHlthinsAt;		// 건강보험
		        	if(hlthinsAt == "Y"){
		        		hlthinsAt = "보험 유";
					}else{
						hlthinsAt = "보험 무";
					}
					var hsptlzAt = item.patientVO.patntHsptlzAt;
					
					var time = new Date(item.rceptVO.rceptDt);			// 접수 일시
					var hour = time.getHours().toString().padStart(2,'0');
					var minute = time.getMinutes().toString().padStart(2,'0');
					var rcepttime = hour + ":" + minute; 	
					
					var no = item.rceptVO.patntNo;					// 환자 번호
					var birthDay = item.patientVO.patntRrno1.toString()	// 생년월일
					var birth = birthDay.substring(0,2) + "." + birthDay.substring(2,4) + "." + birthDay.substring(4,6);	// 생년월일
					var age = item.patientVO.patntAge;					// 나이
					var gender = item.patientVO.patntSexdstn;			// 성별
					if(gender == "M"){
						gender = "남";
					}else{
						gender = "여";
					}
					var memo = item.rceptVO.rceptReason;				// 내원 이유
					if(memo == "null"){
						memo = " ";
					}
					
					var itemList = "";
					itemList += "<div class='bg-white dark__bg-1100 d-md-flex d-xl-inline-block d-xxl-flex align-items-center p-3 rounded-3 shadow-sm card-view-height gap-1'>";
					itemList += "<div class='d-flex align-items-start align-items-sm-center'>";
					itemList += "<div class='row align-items-center gx-0 gy-2'>";
					itemList += "<div class='col-auto'>";
					itemList += "<div class='row'>";
					itemList += "<div class='col-7'>";
					itemList += "<span class='fas fa-user' data-fa-transform='shrink-3 up-1'></span>";
					itemList += " <span style='font-weight: bold;'>" + name + "</span>";
					itemList += "</div>";
					itemList += "<div class='col-5' style='padding-right: 10px; display: flex; justify-content: flex-end;'>";
					itemList += "<button class='btn btn-sm btn-outline-" + color +"' style='padding-right:5px; padding-left:5px; font-size: x-small;'>" + status +"</button>";
					itemList += "</div>";
					itemList += "</div>";
					itemList += "<div class='row' style='font-size: small;'>";
					itemList += "<span>" + no + " | " + hlthinsAt + " | " + rcepttime + "</span><br/>";
					itemList += "<span>" + birth + " | 만 " + age + "세 | " + gender + "</span>";
					itemList += "</div>";
					itemList += "</div>";
					itemList += "<hr style='margin-bottom: 0px;'/>";
					itemList += "<div class='col-auto'>";
					itemList += "<h6 class='mb-0 text-500 pt-0'>" + memo + "</h6>";
					itemList += "</div>";
					itemList += "</div>";
					itemList += "</div>";
					itemList += "</div>";
					
					doneClinicList += itemList;
				}
				
        	});
			$("#doneClinicList").empty().append(doneClinicList);
        },
        error: function(){
        	alert("서버오류! 다시 시도해주세요.");
        }
	});
});

// 진료완료 환자 리스트
$(function(){
	var doneClinicBtn = $("#doneClinicBtn");
	
	doneClinicBtn.on('click',function(){
		
		$.ajax({
			type: "get",
			url: "/mediform/doctor/room/list",
			contentType : "application/json; charset=utf-8",
	        beforeSend : function(xhr){
	        	 xhr.setRequestHeader(header,token);
	        },
	        success : function(data){
				var doneClinicList = "";
				console.log(data);
				
	        	$.each(data, function(index, item) {
					var status = item.rceptVO.rceptSttus;					// 상태
					
					if(status == "2" | status == "5" | status == "7" | status == "8" | status == "9"){
						if(status == "2"){
							status = "진료완료";
						}else if(status == "5"){
							status = "물리치료";
						}else if(status == "5"){
							status = "물리치료";
						}else if(status == "7"){
							status = "작업치료";
						}else if(status == "8"){
							status = "작업치료";
						}else if(status == "9"){
							status = "수납완료";
						}
						var name = item.patientVO.patntNm;					// 환자명
						
			        	var hlthinsAt = item.patientVO.patntHlthinsAt;		// 건강보험
			        	if(hlthinsAt == "Y"){
			        		hlthinsAt = "보험 유";
						}else{
							hlthinsAt = "보험 무";
						}
						var hsptlzAt = item.patientVO.patntHsptlzAt;
						
						var time = new Date(item.rceptVO.rceptDt);			// 접수 일시
						var hour = time.getHours().toString().padStart(2,'0');
						var minute = time.getMinutes().toString().padStart(2,'0');
						var rcepttime = hour + ":" + minute; 	
						
						var no = item.rceptVO.patntNo;					// 환자 번호
						var birthDay = item.patientVO.patntRrno1.toString()	// 생년월일
						var birth = birthDay.substring(0,2) + "." + birthDay.substring(2,4) + "." + birthDay.substring(4,6);	// 생년월일
						var age = item.patientVO.patntAge;					// 나이
						var gender = item.patientVO.patntSexdstn;			// 성별
						if(gender == "M"){
							gender = "남";
						}else{
							gender = "여";
						}
						var memo = item.rceptVO.rceptReason;				// 내원 이유
						if(memo == "null"){
							memo = " ";
						}
						
						var itemList = "";
						itemList += "<div class='bg-white dark__bg-1100 d-md-flex d-xl-inline-block d-xxl-flex align-items-center p-3 rounded-3 shadow-sm card-view-height gap-1'>";
						itemList += "<div class='d-flex align-items-start align-items-sm-center'>";
						itemList += "<div class='row align-items-center gx-0 gy-2'>";
						itemList += "<div class='col-auto'>";
						itemList += "<div class='row'>";
						itemList += "<div class='col-7'>";
						itemList += "<span class='fas fa-user' data-fa-transform='shrink-3 up-1'></span>";
						itemList += " <span style='font-weight: bold;'>" + name + "</span>";
						itemList += "</div>";
						itemList += "<div class='col-5' style='padding-right: 10px; display: flex; justify-content: flex-end;'>";
						itemList += "<button class='btn btn-sm btn-outline-primary' style='padding-right:5px; padding-left:5px;'>" + status +"</button>";
						itemList += "</div>";
						itemList += "</div>";
						itemList += "<div class='row' style='font-size: small;'>";
						itemList += "<span>" + no + " | " + hlthinsAt + " | " + rcepttime + "</span><br/>";
						itemList += "<span>" + birth + " | 만 " + age + "세 | " + gender + "</span>";
						itemList += "</div>";
						itemList += "</div>";
						itemList += "<hr style='margin-bottom: 0px;'/>";
						itemList += "<div class='col-auto'>";
						itemList += "<h6 class='mb-0 text-500 pt-0'>memo</h6>";
						itemList += "</div>";
						itemList += "</div>";
						itemList += "</div>";
						itemList += "</div>";
						
						doneClinicList += itemList;
					}
	        	});
				$("#doneClinicList").empty().append(doneClinicList);
				
	        	console.log(doneClinicList);
	        },
	        error: function(){
	        	alert("서버오류! 다시 시도해주세요.");
	        }
		});
	});
});

// 진료 등록 관련 시작 ============================================================================================================
$(function(){
	var hsptlzAtText = $("#hsptlzAtText");
	var hsptlzAt = $("#hsptlzAt");
	var clnicInsertBtn = $("#clnicInsertBtn");
	
	// 입원 텍스트 클릭시에도 체크 박스 사용 기능
	$(hsptlzAtText).on("click", function(){
		if(hsptlzAt.prop('checked')){
			hsptlzAt.prop('checked', false);	
		}else{
			hsptlzAt.prop('checked', true);
		}
	});
	
	// 진료 insert()
	$(clnicInsertBtn).on("click", function(){
		var rceptNo = $("#rceptNo").val();
		var patntNo = $("#patient").val();
		var empNo = $("#empNo").data("empno");
		var clnicTime = $("#clnicTimeText").text();
		console.log("진료 시간 : " + clnicTime);
		
		console.log();
		var clnicTimeParts = clnicTime.split(/[년월일 :]/).filter(function(part) {
		    return part !== ''; // 빈 문자열 제거
		});
		var year = clnicTimeParts[0];
		var month = clnicTimeParts[1];
		var day = clnicTimeParts[2];
		var hours = clnicTimeParts[3];
		var minu = clnicTimeParts[4];
		console.log("날짜 조합 : " + year + "-" + month +"-" + day +" " + hours + ":" + minu);
		clnicTime = year + "-" + month +"-" + day +" " + hours + ":" + minu;
		var clnicCn = $("#clnicCn").val();	
		var clnicAt = 'Y';
		var beforeClnicNo = "";
		var hsptlzAtVal = "";
		if(hsptlzAt.prop('checked')){
			hsptlzAtVal = hsptlzAt.val();
		}
		console.log("접수 번호 가져오나 >? " + rceptNo);
		console.log("뭐가 나올 까? : "+patntNo);
		var clnicMemo = "";
		var sckwndMain = "";
		var beforeClnicNo = "";
		var atfssDt = null;
		var kcd = "";
		var clinicObj = "";
		if(atfssDt == "" || atfssDt == null){
			clinicObj = {
				"rceptNo" : rceptNo,
				"patntNo" : patntNo,
				"empNo" : empNo,
				"clnicTime" : clnicTime,
				"clnicCn" : clnicCn,
				"clnicAt" : clnicAt,
				"beforeClnicNo" : beforeClnicNo,
				"hsptlzAt" : hsptlzAtVal,
				"clnicMemo" : clnicMemo,
				"sckwndMain" : sckwndMain,
				"kcd" : kcd
			};	
		}else{
			clinicObj = {
				"rceptNo" : rceptNo,
				"patntNo" : patntNo,
				"empNo" : empNo,
				"clnicTime" : clnicTime,
				"clnicCn" : clnicCn,
				"clnicAt" : clnicAt,
				"beforeClnicNo" : beforeClnicNo,
				"hsptlzAt" : hsptlzAtVal,
				"clnicMemo" : clnicMemo,
				"atfssDt" : atfssDt,
				"sckwndMain" : sckwndMain,
				"kcd" : kcd
			};	
		}
		
		$.ajax({
			type : "post",
	 		url  : "/mediform/doctor/clinic/insert",
	 		data : JSON.stringify(clinicObj),
	 		contentType : "application/json; charset=utf-8",
	         beforeSend : function(xhr){
	             //ajax호출 중 처리
	             //글로벌 변수로 설정한 csrf token 셋팅
	             xhr.setRequestHeader(header,token);
	         },
	 		success : function(res){
	 			console.log("성공 : " + res);
	 			if(res == 'OK'){
	 				Swal.fire({
					      icon: 'success',
					      title: '진료 등록',
					      text: '정상적으로 등록되었습니다.',
					      confirmButtonColor: 'blue'
					    });
	 			}else{
	 				Swal.fire({
					      icon: 'error',
					      title: '진료 등록',
					      text: '등록이 정상적으로 진행되지 않았습니다.',
					      confirmButtonColor: 'blue'
					    });
	 			}
	 			
	 		},
	 		error : function(err){
	 			console.log("에러 발생 : " + err.status);
	 		}
		});
		
	});
	
	
});
// 진료 등록 관련 끝 ============================================================================================================

// 상병 관련 스크립트 시작=======================================================================================================
$(function(){
	// 상병 검색 관련
	var sawlTbody = $("#sawlTbody");
	var sawlInput = $(".sawlInput");
	var sawlSearchBox = $("#sawlSearchBox");
	var sawlMenu = $("#sawlMenu");
	var sawlDropMenu = $("#sawlDropMenu");
	var sawlInsertTable = $(".sawlInsertTable");
	var idNo = 1;
	var sawlTbodyHtml = "";
	
	// 상병 검색 시작
	$(function(){
		// 검색창 포커스 아웃일 때 드롭다운 사라지게 만들기
		sawlInput.focusout(function(){
			setTimeout(() => {
				$(sawlDropMenu).hide();
			}, 100);
		});
		
		// 검색창 포커스인
		sawlInput.focusin(function(){
			$(sawlDropMenu).show();
			if(sawlInput.val() == "" || sawlInput.val() == null){
				
				$.ajax({
					type : "post",
					url  : "/mediform/doctor/sickAndWoundedList/list",
					contentType : "application/json; charset=utf-8",
			        beforeSend : function(xhr){
			            //ajax호출 중 처리
			            //글로벌 변수로 설정한 csrf token 셋팅
			            xhr.setRequestHeader(header,token);
			        },
					success : function(res){
						var sawlDropItemHtml = "";
						sawlTbodyHtml = "";
						$(res).each(function(idx, item){
							sawlDropItemHtml = sawlDropItem(this.sickcd, this.krnm, this.sicknm, this.msick)
						});
						$(sawlTbody).html(sawlDropItemHtml);
					},
					error : function(err){
						console.log(err.status);
					}
				});
				
			}
		});
		
		// 상병 keyup 검색
		sawlInput.on("keyup",function(event){
			if(event.which != 13){
				var sawlKeyword = sawlInput.val();
				var sawlKeywordObj = { 
						sawlKeyword : sawlKeyword
						};
				// 검색 정보
				$.ajax({
					type : "post",
					url  : "/mediform/doctor/sickAndWoundedList/select",
					data : JSON.stringify(sawlKeywordObj),
					contentType : "application/json; charset=utf-8",
			        beforeSend : function(xhr){
			            //ajax호출 중 처리
			            //글로벌 변수로 설정한 csrf token 셋팅
			            xhr.setRequestHeader(header,token);
			        },
					success : function(res){
						var sawlDropItemHtml = "";
						sawlTbodyHtml = "";
						if(res.length == 0){
							sawlDropItemHtml += "<tr class='text-center row dropdown-item px-x1 py-2 mb-0'>";
							sawlDropItemHtml += '<td class="col-12 text-black fw-bold fw-3 ">조회하신 검사가 없습니다.</td>';
							sawlDropItemHtml += '</tr>';
						}else{
							$(res).each(function(idx, item){
								sawlDropItemHtml = sawlDropItem(this.sickcd, this.krnm, this.sicknm, this.msick)
							});
						}
						$(sawlTbody).html(sawlDropItemHtml);
					},
					error : function(err){
						console.log("err에러 : " + err);
					}
				});
			}
		});
		
		// 상병 결과 누르기 이벤트들 시작 ---------------------------------------------
		// 엔터 눌렀을 시 제일 위에 상병 정보를 찾는다.
		$(sawlInput).keypress(function(event){
			if(event.which == 13){
				event.preventDefault();
				var hlthchkpCd = sawlTbody.children("tr:eq(0)").data("sickcd");
				var hlthchkpNm = sawlTbody.children("tr:eq(0)").data("krnm");
				var mllwncAt = sawlTbody.children("tr:eq(0)").data("sicknm");
				var msick = sawlTbody.children("tr:eq(0)").data("msick");
				// input태그 비우기
				$(sawlInput).val("");
				// 상병 테이블에 넣어주기
				selectSAWLAjax(sickcd, krnm, sicknm, msick);
				
				sawlInput.blur();
				$(sawlDropMenu).hide();
			}
		});
		
		// 검색창 목록 클릭 이벤트
		$(sawlTbody).on("click", function(){
			var targets = $(event.target);
			// 클릭된 요소의 부모인 tr 태그
			var clickTr = "";
			
			if(targets.is('td')){
				clickTr = targets.closest('tr');
			}else if(targets.is('tr')){
				clickTr = targets;
			}
			var sickcd = clickTr.data("sickcd");
			var krnm = clickTr.data("krnm");
			var sicknm = clickTr.data("sicknm");
			var msick = clickTr.data("msick");
			
			// input 태그 비워주기
			$(sawlInput).val("");
			
			selectSAWLAjax(sickcd, krnm, sicknm, msick);
			sawlInput.blur();
			$(sawlDropMenu).hide();
		});
		
		// 상병 결과 누르기 이벤트들 끝 ------------------------------------------------
		// 상병 테이블(sawlInsertTable)에 넣어주기
		function selectSAWLAjax(sickcd, krnm, sicknm, msick){
			idNo++;
			var sawlInsertTableHtml = "";
	      
			sawlInsertTableHtml += "<tr class='row px-x1 py-2 mb-0 hover-primary text-center'>";
			sawlInsertTableHtml += '<td class="col-1 align-middle white-space-nowrap">';
			sawlInsertTableHtml += '<div class="form-check mb-0">';
			sawlInsertTableHtml += '<input class="form-check-input sawlCheckTd" type="checkbox" id="checkbox-'+idNo+'"/>';
			sawlInsertTableHtml += '</div>';
			sawlInsertTableHtml += '</td>';
			sawlInsertTableHtml += "<td class='col-2'>" + sickcd + "</td>";
			sawlInsertTableHtml += "<td class='col-3'>" + krnm + "</td>";
			sawlInsertTableHtml += "<td class='col-3'>" + sicknm + "</td>";
			sawlInsertTableHtml += "<td class='col-2'>" + msick + "</td>";
			sawlInsertTableHtml += "<td class='col-1'><div class='btn-close-falcon sawlDel'></div></td>";
			sawlInsertTableHtml += "</tr>";
			
			sawlInsertTable.append(sawlInsertTableHtml);
		}
		
		// 상병 검색창에 목록 생성
		function sawlDropItem(sickcd, krnm, sicknm, msick){
			sawlTbodyHtml += "<tr class='row dropdown-item px-x1 py-2 mb-0 hover-primary pointer'"
				+ "data-sickcd='"+sickcd+"' data-krnm='"+krnm+"' data-sicknm='"+sicknm+"' data-msick='"+msick+"'>";
			sawlTbodyHtml += "<td class='col-3'>"+sickcd+"</td>";
			sawlTbodyHtml += "<td class='col-4'>"+krnm+"</td>";
			sawlTbodyHtml += "<td class='col-3'>"+sicknm+"</td>";
			if(msick == null || msick == ""){
				msick = 'N';
			}
			sawlTbodyHtml += "<td class='col-2'>"+msick+"</td>";
			sawlTbodyHtml += "</tr>";
			
			return sawlTbodyHtml;
		}
		
	});
	// 상병 검색 끝
	
	
	// 상병 테이블 체크 박스
	$(function(){
		var sawlCheckTh = $("#sawlCheckTh");
		var sawlCheckTable = $("#sawlCheckTable");
		var sawlAllDelBtn = $("#sawlAllDelBtn");
		
		// th체크 박스로 모든 체크 박스 컨트롤
		$(sawlCheckTh).on('change', function() {
			// sawlCheckTh체크 박스랑 동일한 체크가 된다.
	       	$(".sawlCheckTd").prop('checked', this.checked);
	    });
		
		// x 버튼 클릭 삭제기능
		$(sawlInsertTable).on("click",".sawlDel", function(event){
			var btnClick = event.target.closest('tr');
			btnClick.remove();			
		});
		
		// 삭제 버튼을 눌렀을 때 체크된 것들 삭제 기능
		$(sawlAllDelBtn).on("click", function(){
			var sawlTdCheckAll = $(".sawlInsertTable input[type=checkbox]:checked");
			sawlTdCheckAll.closest('tr').remove();
			$(sawlCheckTh).prop('checked', false);
		});
		
	});
	
});
// 상병 관련 스크립트 끝=======================================================================================================
// 검사 관련 스크립트 시작=======================================================================================================
$(function(){
	// 검사 검색 관련
	var hCTbody = $("#hCTbody");
	var hCInput = $(".hCInput");
	var hcSearchBox = $("#hcSearchBox");
	var hcMenu = $("#hcMenu");
	var hcDropMenu = $("#hcDropMenu");
	var hcInsertTable = $(".hcInsertTable");
	var idNo = 1;
	var hCTbodyHtml = "";
	
	// 검사 검색 시작
	$(function(){
		// 검색창 포커스 아웃일 때 드롭다운 사라지게 만들기
		hCInput.focusout(function(){
			setTimeout(() => {
				$(hcDropMenu).hide();
			}, 100);
		});
		
		// 검색창 포커스인
		hCInput.focusin(function(){
			$(hcDropMenu).show();
			if(hCInput.val() == "" || hCInput.val() == null){
				
				$.ajax({
					type : "post",
					url  : "/mediform/doctor/healthCheckup/list",
					contentType : "application/json; charset=utf-8",
			        beforeSend : function(xhr){
			            //ajax호출 중 처리
			            //글로벌 변수로 설정한 csrf token 셋팅
			            xhr.setRequestHeader(header,token);
			        },
					success : function(res){
						var hcDropItemHtml = "";
						hCTbodyHtml = "";
						$(res).each(function(idx, item){
							hcDropItemHtml = hcDropItem(this.hlthchkpCd, this.hlthchkpNm, this.mllwncAt)
						});
						$(hCTbody).html(hcDropItemHtml);
					},
					error : function(err){
						console.log(err.status);
					}
				});
				
			}
		});
		
		// 검사 keyup 검색
		hCInput.on("keyup",function(event){
			if(event.which != 13){
				var hCKeyword = hCInput.val();
				var hCKeywordObj = { 
						hCKeyword : hCKeyword
						};
				// 검색 환자 정보
				$.ajax({
					type : "post",
					url  : "/mediform/doctor/healthCheckup/select",
					data : JSON.stringify(hCKeywordObj),
					contentType : "application/json; charset=utf-8",
			        beforeSend : function(xhr){
			            //ajax호출 중 처리
			            //글로벌 변수로 설정한 csrf token 셋팅
			            xhr.setRequestHeader(header,token);
			        },
					success : function(res){
						var hcDropItemHtml = "";
						hCTbodyHtml = "";
						if(res.length == 0){
							hcDropItemHtml += "<tr class='text-center row dropdown-item px-x1 py-2 mb-0'>";
							hcDropItemHtml += '<td class="col-12 text-black fw-bold fw-3 ">조회하신 검사가 없습니다.</td>';
							hcDropItemHtml += '</tr>';
						}else{
							$(res).each(function(idx, item){
								hcDropItemHtml = hcDropItem(this.hlthchkpCd, this.hlthchkpNm, this.mllwncAt)
							});
						}
						$(hCTbody).html(hcDropItemHtml);
					},
					error : function(err){
						console.log("err에러 : " + err);
					}
				});
			}
		});
		
		// 검사 결과 누르기 이벤트들 시작 ---------------------------------------------
		// 엔터 눌렀을 시 제일 위에 검사 코드를 찾는다.
		$(hCInput).keypress(function(event){
			if(event.which == 13){
				event.preventDefault();
				var hlthchkpCd = hCTbody.children("tr:eq(0)").data("hccd");
				var hlthchkpNm = hCTbody.children("tr:eq(0)").data("hcnm");
				var mllwncAt = hCTbody.children("tr:eq(0)").data("mllat");
				// input태그 비우기
				$(hCInput).val("");
				// 검사 테이블에 넣어주기
				selectHCAjax(hlthchkpCd, hlthchkpNm, mllwncAt);
				
				hCInput.blur();
				$(hcDropMenu).hide();
			}
		});
		
		// 검색창 목록 클릭 이벤트
		$(hCTbody).on("click", function(){
			var targets = $(event.target);
			// 클릭된 요소의 부모인 tr 태그
			var clickTr = "";
			
			if(targets.is('td')){
				clickTr = targets.closest('tr');
			}else if(targets.is('tr')){
				clickTr = targets;
			}
			var hlthchkpCd = clickTr.data("hccd");
			var hlthchkpNm = clickTr.data("hcnm");
			var mllwncAt = clickTr.data("mllat");
			
			// input 태그 비워주기
			$(hCInput).val("");
			
			selectHCAjax(hlthchkpCd, hlthchkpNm, mllwncAt);
			hCInput.blur();
			$(hcDropMenu).hide();
		});
		
		// 검사 결과 누르기 이벤트들 끝 ------------------------------------------------
		// 검사 테이블(hcInsertTable)에 넣어주기
		function selectHCAjax(hlthchkpCd, hlthchkpNm, mllwncAt){
			idNo++;
			var hcInsertTableHtml = "";
	      
			hcInsertTableHtml += "<tr class='row px-x1 py-2 mb-0 hover-primary text-center'>";
			hcInsertTableHtml += '<td class="col-1 align-middle white-space-nowrap">';
			hcInsertTableHtml += '<div class="form-check mb-0">';
			hcInsertTableHtml += '<input class="form-check-input hcCheckTd" type="checkbox" id="checkbox-'+idNo+'"/>';
			hcInsertTableHtml += '</div>';
			hcInsertTableHtml += '</td>';
			hcInsertTableHtml += "<td class='col-3'>" + hlthchkpCd + "</td>";
			hcInsertTableHtml += "<td class='col-3'>" + hlthchkpNm + "</td>";
			hcInsertTableHtml += "<td class='col-3'>" + mllwncAt + "</td>";
			hcInsertTableHtml += "<td class='col-2'><div class='btn-close-falcon hcDel'></div></td>";
			hcInsertTableHtml += "</tr>";
			
			hcInsertTable.append(hcInsertTableHtml);
		}
		
		// 검사 검색창에 목록 생성
		function hcDropItem(hlthchkpCd, hlthchkpNm, mllwncAt){
			hCTbodyHtml += "<tr class='row dropdown-item px-x1 py-2 mb-0 hover-primary pointer'"
				+ "data-hccd='"+hlthchkpCd+"' data-hcnm='"+hlthchkpNm+"' data-mllat='"+mllwncAt+"'>";
			hCTbodyHtml += "<td class='col-3'>"+hlthchkpCd+"</td>";
			hCTbodyHtml += "<td class='col-7 hlthchkpNm'>"+hlthchkpNm+"</td>";
			hCTbodyHtml += "<td class='col-2'>"+mllwncAt+"</td>";
			hCTbodyHtml += "</tr>";
			
			return hCTbodyHtml;
		}
		
	});
	// 검사 검색 끝
	
	
	// 검사 테이블 체크 박스
	$(function(){
		var hcCheckTh = $("#hcCheckTh");
		var hcCheckTable = $("#hcCheckTable");
		var hcAllDelBtn = $("#hcAllDelBtn");
		
		// th체크 박스로 모든 체크 박스 컨트롤
		$(hcCheckTh).on('change', function() {
			// hcCheckTh체크 박스랑 동일한 체크가 된다.
	       	$(".hcCheckTd").prop('checked', this.checked);
	    });
		
		// x 버튼 클릭 삭제기능
		$(hcInsertTable).on("click",".hcDel", function(event){
			var btnClick = event.target.closest('tr');
			btnClick.remove();			
		});
		
		// 삭제 버튼을 눌렀을 때 체크된 것들 삭제 기능
		$(hcAllDelBtn).on("click", function(){
			var hcTdCheckAll = $(".hcInsertTable input[type=checkbox]:checked");
			hcTdCheckAll.closest('tr').remove();
			$(hcCheckTh).prop('checked', false);
		});
		
	});
	
	var hcOrderBtn = $("#hcOrderBtn");
	
	$(hcOrderBtn).on("click", function(){
		
	});
});
//검사 관련 스크립트 끝=======================================================================================================
// 치료 관련 스크립트 시작=======================================================================================================
$(function(){
	// 치료 검색 관련
	var mtTbody = $("#mtTbody");
	var mtInput = $(".mtInput");
	var mtSearchBox = $("#mtSearchBox");
	var mtMenu = $("#mtMenu");
	var mtDropMenu = $("#mtDropMenu");
	var mtInsertTable = $(".mtInsertTable");
	var idNo = 1;
	var mtTbodyHtml = "";
	
	// 치료 검색 시작
	$(function(){
		// 치료창 포커스 아웃일 때 드롭다운 사라지게 만들기
		mtInput.focusout(function(){
			setTimeout(() => {
				$(mtDropMenu).hide();
			}, 100);
		});
		
		// 치료창 포커스인
		mtInput.focusin(function(){
			$(mtDropMenu).show();
			if(mtInput.val() == "" || mtInput.val() == null){
				
				$.ajax({
					type : "post",
					url  : "/mediform/doctor/medicalTreatment/list",
					contentType : "application/json; charset=utf-8",
			        beforeSend : function(xhr){
			            //ajax호출 중 처리
			            //글로벌 변수로 설정한 csrf token 셋팅
			            xhr.setRequestHeader(header,token);
			        },
					success : function(res){
						var mtDropItemHtml = "";
						mtTbodyHtml = "";
						$(res).each(function(idx, item){
							mtDropItemHtml = mtDropItem(this.mdlrtCd, this.mdlrtNm, this.mllwncAt)
						});
						$(mtTbody).html(mtDropItemHtml);
					},
					error : function(err){
						console.log(err.status);
					}
				});
				
			}
		});
		
		// 치료 keyup 검색
		mtInput.on("keyup",function(event){
			if(event.which != 13){
				var mtKeyword = mtInput.val();
				var mtKeywordObj = { 
						mtKeyword : mtKeyword
						};
				// 치료 환자 정보
				$.ajax({
					type : "post",
					url  : "/mediform/doctor/medicalTreatment/select",
					data : JSON.stringify(mtKeywordObj),
					contentType : "application/json; charset=utf-8",
			        beforeSend : function(xhr){
			            //ajax호출 중 처리
			            //글로벌 변수로 설정한 csrf token 셋팅
			            xhr.setRequestHeader(header,token);
			        },
					success : function(res){
						var mtDropItemHtml = "";
						mtTbodyHtml = "";
						if(res.length == 0){
							mtDropItemHtml += "<tr class='text-center row dropdown-item px-x1 py-2 mb-0'>";
							mtDropItemHtml += '<td class="col-12 text-black fw-bold fw-3 ">조회하신 검사가 없습니다.</td>';
							mtDropItemHtml += '</tr>';
						}else{
							$(res).each(function(idx, item){
								mtDropItemHtml = mtDropItem(this.mdlrtCd, this.mdlrtNm, this.mllwncAt)
							});
						}
						$(mtTbody).html(mtDropItemHtml);
					},
					error : function(err){
						console.log("err에러 : " + err);
					}
				});
			}
		});
		
		// 치료 결과 누르기 이벤트들 시작 ---------------------------------------------
		// 엔터 눌렀을 시 제일 위에 치료 코드를 찾는다.
		$(mtInput).keypress(function(event){
			if(event.which == 13){
				event.preventDefault();
				var mdlrtCd = mtTbody.children("tr:eq(0)").data("mtcd");
				var mdlrtNm = mtTbody.children("tr:eq(0)").data("mtnm");
				var mllwncAt = mtTbody.children("tr:eq(0)").data("mtmllat");
				// input태그에 선택된 이름 넣어주기
				$(mtInput).val("");
				// 치료 테이블에 넣어주기
				selectMTAjax(mdlrtCd, mdlrtNm, mllwncAt);
				
				mtInput.blur();
				$(mtDropMenu).hide();
			}
		});
		
		// 치료창 목록 클릭 이벤트
		$(mtTbody).on("click", function(){
			var targets = $(event.target);
			// 클릭된 요소의 부모인 tr 태그
			var clickTr = "";
			
			if(targets.is('td')){
				clickTr = targets.closest('tr');
			}else if(targets.is('tr')){
				clickTr = targets;
			}
			var mdlrtCd = clickTr.data("mtcd");
			var mdlrtNm = clickTr.data("mtnm");
			var mllwncAt = clickTr.data("mtmllat");
			// input 태그 비워주기
			$(mtInput).val("");
			
			selectMTAjax(mdlrtCd, mdlrtNm, mllwncAt);
			mtInput.blur();
			$(mtDropMenu).hide();
		});
		
		// 치료 결과 누르기 이벤트들 끝 ------------------------------------------------
		// 치료 테이블(mtInsertTable)에 넣어주기
		function selectMTAjax(mdlrtCd, mdlrtNm, mllwncAt){
			idNo++;
			var mtInsertTableHtml = "";
	      
			mtInsertTableHtml += "<tr class='row px-x1 py-2 mb-0 hover-primary text-center'>";
			mtInsertTableHtml += '<td class="col-1 align-middle white-space-nowrap">';
			mtInsertTableHtml += '<div class="form-check mb-0">';
			mtInsertTableHtml += '<input class="form-check-input mtCheckTd" type="checkbox" id="checkbox-'+idNo+'"/>';
			mtInsertTableHtml += '</div>';
			mtInsertTableHtml += '</td>';
			mtInsertTableHtml += "<td class='col-3'>" + mdlrtCd + "</td>";
			mtInsertTableHtml += "<td class='col-3'>" + mdlrtNm + "</td>";
			mtInsertTableHtml += "<td class='col-3'>" + mllwncAt + "</td>";
			mtInsertTableHtml += "<td class='col-2'><div class='btn-close-falcon mtDel'></div></td>";
			mtInsertTableHtml += "</tr>";
			
			mtInsertTable.append(mtInsertTableHtml);
		}
		
		// 치료 검색창에 목록 생성
		function mtDropItem(mdlrtCd, mdlrtNm, mllwncAt){
			mtTbodyHtml += "<tr class='row dropdown-item px-x1 py-2 mb-0 hover-primary pointer'"
				+ "data-mtcd='"+mdlrtCd+"' data-mtnm='"+mdlrtNm+"' data-mtmllat='"+mllwncAt+"'>";
			mtTbodyHtml += "<td class='col-3'>"+mdlrtCd+"</td>";
			mtTbodyHtml += "<td class='col-7'>"+mdlrtNm+"</td>";
			mtTbodyHtml += "<td class='col-2'>"+mllwncAt+"</td>";
			mtTbodyHtml += "</tr>";
			
			return mtTbodyHtml;
		}
		
	});
	// 치료 검색 끝
	
	
	// 치료 테이블 체크 박스
	$(function(){
		var mtCheckTh = $("#mtCheckTh");
		var mtCheckTable = $("#mtCheckTable");
		var mtAllDelBtn = $("#mtAllDelBtn");
		
		// th체크 박스로 모든 체크 박스 컨트롤
		$(mtCheckTh).on('change', function() {
			// mtrCheckTh체크 박스랑 동일한 체크가 된다.
	       	$(".mtCheckTd").prop('checked', this.checked);
	    });
		
		// x 버튼 클릭 삭제기능
		$(mtInsertTable).on("click",".mtDel", function(event){
			var btnClick = event.target.closest('tr');
			btnClick.remove();			
		});
		
		// 삭제 버튼을 눌렀을 때 체크된 것들 삭제 기능
		$(mtAllDelBtn).on("click", function(){
			var mtTdCheckAll = $(".mtInsertTable input[type=checkbox]:checked");
			mtTdCheckAll.closest('tr').remove();
			$(mtCheckTh).prop('checked', false);
		});
		
	});
	
});
// 치료 관련 스크립트 끝=======================================================================================================	
// 처방 관련 스크립트 시작=======================================================================================================
$(function(){
	// 처방 검색 관련
	var mTbody = $("#mTbody");
	var mInput = $(".mInput");
	var mSearchBox = $("#mSearchBox");
	var mMenu = $("#mMenu");
	var mDropMenu = $("#mDropMenu");
	var mInsertTable = $(".mInsertTable");
	var idNo = 1;
	var mTbodyHtml = "";
	
	// 처방 검색 시작
	$(function(){
		// 처방창 포커스 아웃일 때 드롭다운 사라지게 만들기
		mInput.focusout(function(){
			setTimeout(() => {
				$(mDropMenu).hide();
			}, 100);
		});
		
		// 검색창 포커스인
		mInput.focusin(function(){
			$(mDropMenu).show();
			if(mInput.val() == "" || mInput.val() == null){
				
				$.ajax({
					type : "post",
					url  : "/mediform/doctor/medicine/list",
					contentType : "application/json; charset=utf-8",
			        beforeSend : function(xhr){
			            //ajax호출 중 처리
			            //글로벌 변수로 설정한 csrf token 셋팅
			            xhr.setRequestHeader(header,token);
			        },
					success : function(res){
						var mDropItemHtml = "";
						mTbodyHtml = "";
						$(res).each(function(idx, item){
							mDropItemHtml = mDropItem(this.medcinCd, this.medcinNm, this.medcinMfbiz, this.mdctnCours, this.medcinUnit)
						});
						$(mTbody).html(mDropItemHtml);
					},
					error : function(err){
						console.log(err.status);
					}
				});
				
			}
		});
		
		// 처방 keyup 검색
		mInput.on("keyup",function(event){
			if(event.which != 13){
				var mKeyword = mInput.val();
				var mKeywordObj = { 
						mKeyword : mKeyword
						};
				// 처방 환자 정보
				$.ajax({
					type : "post",
					url  : "/mediform/doctor/medicine/select",
					data : JSON.stringify(mKeywordObj),
					contentType : "application/json; charset=utf-8",
			        beforeSend : function(xhr){
			            //ajax호출 중 처리
			            //글로벌 변수로 설정한 csrf token 셋팅
			            xhr.setRequestHeader(header,token);
			        },
					success : function(res){
						var mDropItemHtml = "";
						mTbodyHtml = "";
						if(res.length == 0){
							mDropItemHtml += "<tr class='text-center row dropdown-item px-x1 py-2 mb-0'>";
							mDropItemHtml += '<td class="col-12 text-black fw-bold fw-3 ">조회하신 검사가 없습니다.</td>';
							mDropItemHtml += '</tr>';
						}else{
							$(res).each(function(idx, item){
								mDropItemHtml = mDropItem(this.medcinCd, this.medcinNm, this.medcinMfbiz, this.mdctnCours, this.medcinUnit)
							});
						}
						$(mTbody).html(mDropItemHtml);
					},
					error : function(err){
						console.log("err에러 : " + err);
					}
				});
			}
		});
		
		// 처방 결과 누르기 이벤트들 시작 ---------------------------------------------
		// 엔터 눌렀을 시 제일 위에 처방 코드를 찾는다.
		$(mInput).keypress(function(event){
			if(event.which == 13){
				event.preventDefault();
				var medcinCd = mTbody.children("tr:eq(0)").data("medcd");
				var medcinNm = mTbody.children("tr:eq(0)").data("mednm");
				var medcinMfbiz = mTbody.children("tr:eq(0)").data("medmfbiz");
				var mdctnCours = mTbody.children("tr:eq(0)").data("mdctncours");
				var medcinUnit = mTbody.children("tr:eq(0)").data("medcinunit");
				// input태그에 선택된 이름 넣어주기
				$(mInput).val("");
				// 처방 테이블에 넣어주기
				selectMAjax(medcinCd, medcinNm, medcinMfbiz, mdctnCours, medcinUnit);
				
				mInput.blur();
				$(mDropMenu).hide();
			}
		});
		
		// 검색창 목록 클릭 이벤트
		$(mTbody).on("click", function(){
			var targets = $(event.target);
			// 클릭된 요소의 부모인 tr 태그
			var clickTr = "";
			
			if(targets.is('td')){
				clickTr = targets.closest('tr');
			}else if(targets.is('tr')){
				clickTr = targets;
			}
			var medcinCd = clickTr.data("medcd");
			var medcinNm = clickTr.data("mednm");
			var medcinMfbiz = clickTr.data("medmfbiz");
			var mdctnCours = clickTr.data("mdctncours");
			var medcinUnit = clickTr.data("medcinunit");
			// input 태그 비워주기
			$(mInput).val("");
			
			selectMAjax(medcinCd, medcinNm, medcinMfbiz, mdctnCours, medcinUnit);
			mInput.blur();
			$(mDropMenu).hide();
		});
		
		// 처방 결과 누르기 이벤트들 끝 ------------------------------------------------
		// 처방 테이블(mInsertTable)에 넣어주기
		function selectMAjax(medcinCd, medcinNm, medcinMfbiz, mdctnCours, medcinUnit){
			idNo++;
			var mInsertTableHtml = "";
	      
			mInsertTableHtml += "<tr class='row px-x1 py-2 mb-0 hover-primary text-center'>";
			mInsertTableHtml += '<td class="col-1 align-middle white-space-nowrap">';
			mInsertTableHtml += '<div class="form-check mb-0">';
			mInsertTableHtml += '<input class="form-check-input mCheckTd" type="checkbox" id="checkbox-'+idNo+'"/>';
			mInsertTableHtml += '</div>';
			mInsertTableHtml += '</td>';
			mInsertTableHtml += "<td class='col-2'>" + medcinCd + "</td>";
			mInsertTableHtml += "<td class='col-2'>" + medcinNm + "</td>";
			mInsertTableHtml += "<td class='col-2'>" + medcinMfbiz + "</td>";
			mInsertTableHtml += "<td class='col-2'>" + mdctnCours + "</td>";
			mInsertTableHtml += "<td class='col-1'><input type='text' style='width:100%' class='mdctnCpctyInput' value='' />"+medcinUnit+"</td>";
			mInsertTableHtml += "<td class='col-1'><input type='text' style='width:100%' class='mdctnCoInput' value='' /> 회</td>";
			mInsertTableHtml += "<td class='col-1'><input type='text' style='width:100%' class='mdctnPdInput' value='' /> 일</td>";
			mInsertTableHtml += "<td class='col-1'><div class='btn-close-falcon mDel'></div></td>";
			mInsertTableHtml += "</tr>";
			
			mInsertTable.append(mInsertTableHtml);
		}
		
		// 처방 검색창에 목록 생성
		function mDropItem(medcinCd, medcinNm, medcinMfbiz, mdctnCours, medcinUnit){
			mTbodyHtml += "<tr class='row dropdown-item px-x1 py-2 mb-0 hover-primary pointer'"
				+ "data-medcd='"+medcinCd+"' data-mednm='"+medcinNm+"' data-medmfbiz='"+medcinMfbiz+"' data-mdctncours='"+mdctnCours+"' data-medcinunit='"+medcinUnit+"'>";
			mTbodyHtml += "<td class='col-2'>"+medcinCd+"</td>";
			mTbodyHtml += "<td class='col-5'>"+medcinNm+"</td>";
			mTbodyHtml += "<td class='col-3'>"+medcinMfbiz+"</td>";
			mTbodyHtml += "<td class='col-2'>"+mdctnCours+"</td>";
			mTbodyHtml += "</tr>";
			
			return mTbodyHtml;
		}
		
	});
	// 처방 검색 끝
	
	
	// 처방 테이블 체크 박스
	$(function(){
		var mCheckTh = $("#mCheckTh");
		var mCheckTable = $("#mCheckTable");
		var mAllDelBtn = $("#mAllDelBtn");
		
		// th체크 박스로 모든 체크 박스 컨트롤
		$(mCheckTh).on('change', function() {
			// mCheckTh체크 박스랑 동일한 체크가 된다.
	       	$(".mCheckTd").prop('checked', this.checked);
	    });
		
		// x 버튼 클릭 삭제기능
		$(mInsertTable).on("click",".mDel", function(event){
			var btnClick = event.target.closest('tr');
			btnClick.remove();			
		});
		
		// 삭제 버튼을 눌렀을 때 체크된 것들 삭제 기능
		$(mAllDelBtn).on("click", function(){
			var mTdCheckAll = $(".mInsertTable input[type=checkbox]:checked");
			mTdCheckAll.closest('tr').remove();
			$(mCheckTh).prop('checked', false);
		});
		
	});
	
});
// 처방 관련 스크립트 끝=======================================================================================================	
	
</script>
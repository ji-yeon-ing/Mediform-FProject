<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css" />
<script src="https://unpkg.com/picmo@5.7.6/dist/umd/index.js"></script>
<script
	src="https://unpkg.com/@picmo/popup-picker@5.7.6/dist/umd/index.js"></script>
<style>
.table thead {
	position: sticky;
	top: 0;
	z-index: 1;
	/* 다른 콘텐츠 위로 표시하기 위해 z-index를 설정합니다. */
}
</style>

<c:set var="customUser" value="${sessionScope.SPRING_SECURITY_CONTEXT.authentication.principal}" />
<div class="row">
<input type="hidden" id="empNm" value="${ customUser.employee.empNm}">
	<!-- ================================= 환자 상세 조회 시작 =================================================-->
	<div class="col-2">
		<div class="card border border-secondary m-0" style="height: 750px;">

			<div class="row">
				<div class="col">
					<input
						class="fw-semi-bold col-5 text-white text-center form-control"
						id="" name="" type="text" value="환자 상세 정보"
						style="background-color: midnightblue" disabled />
				</div>
			</div>

			<div class="row">
				<div class="col">
					<div class="input-group search-box pt-2 pb-0 px-2">
						<form class="position-relative w-60" data-bs-toggle="search"
							data-bs-display="static">
							<input class="form-control search-input fuzzy-search"
								type="search" placeholder="환자 이름을 입력해주세요." aria-label="Search"
								id="searchInput" style="height: 40px" /> <span
								class="fas fa-search search-box-icon"></span>
						</form>

						<div
							class="dropdown-menu border font-base start-1 mt-2 py-0 overflow-hidden"
							style="top: 35px; width: 270px;">
							<!-- 드롭다운 길이 수정 : max-height: 17rem;  	 -->
							<div class="scrollbar list py-3" style="" id="search-results"></div>
						</div>
					</div>
				</div>
			</div>

			<form>
				<div class="row card-body py-0">
					<div class="tab-content" style="height: 600px;">
						<br>
						<table>
							<tr>
								<th><input
									class="fw-semi-bold col-6  text-black text-center form-control"
									style="width: 50%; height: 30px;" id="" name="" type="text"
									value="차트 번호" disabled /></th>
							</tr>
							<tr>
								<td><input class="text-black form-control bg-white"
									id="clnicNo" name="clnicNo" type="text" value="" disabled /><br>
								</td>
							</tr>
							<tr>
								<th><input
									class="fw-semi-bold col-6  text-black text-center form-control"
									style="width: 50%; height: 30px;" id="" name="" type="text"
									value="수진자명" disabled /></th>
							</tr>
							<tr>
								<td><input class="text-black form-control bg-white"
									id="patntNm" name="patntNm" type="text" value="" disabled /> <br>
								</td>
							</tr>
							<tr>
								<th><input
									class="fw-semi-bold col-6  text-black text-center form-control"
									style="width: 50%; height: 30px;" id="" name="" type="text"
									value="생년월일" disabled /></th>
							</tr>
							<tr>
								<td><input class="text-black form-control bg-white"
									id="patntRrno1" name="patntRrno1" type="text" value="" disabled />
									<br></td>
							</tr>
							<tr>
								<th><input
									class="fw-semi-bold col-6  text-black text-center form-control"
									style="width: 50%; height: 30px;" id="" name="" type="text"
									value="담당의사" disabled /></th>
							</tr>
							<tr>
								<td><input class="text-black form-control bg-white"
									id="empNm" name="empNm" type="text" value="" disabled /> <br>
								</td>
							</tr>
							<tr>
								<th><input
									class="fw-semi-bold col-6  text-black text-center form-control"
									style="width: 50%; height: 30px;" id="" name="" type="text"
									value="입원일자" disabled /></th>
							</tr>
							<tr>
								<td><input class="text-black form-control bg-white"
									id="hsptlzDe" name="hsptlzDe" type="text" value="" disabled />
									<br></td>
							</tr>
							<tr>
								<th><input
									class="fw-semi-bold col-6  text-black text-center form-control"
									style="width: 50%; height: 30px;" id="" name="" type="text"
									value="퇴원 일자" disabled /></th>
							</tr>
							<tr>
								<td><input class="text-black form-control bg-white"
									id="realLhstl" name="realLhstl" type="text" value="" disabled />
									<br></td>
							</tr>
							<tr>
								<th><input
									class="fw-semi-bold col-6  text-black text-center form-control"
									style="width: 50%; height: 30px;" id="" name="" type="text"
									value="호실/병상" disabled /></th>
							</tr>
							<tr>
								<td>
									<div style="width: 35%; white-space: nowrap;">
										<input class="text-black form-control bg-white"
											id="hsptlzSckrm" name="hsptlzSckrm" type="text" value=""
											disabled style="display: inline-block;" />&nbsp;호
										&nbsp;&nbsp; <input class="text-black form-control bg-white"
											id="hsptlzSckbd" name="hsptlzSckbd" type="text" value=""
											disabled style="display: inline-block;" />&nbsp;병상
									</div>
								</td>
							</tr>
						</table>
					</div>
				</div>
			</form>
		</div>
	</div>
	<!-- ================================= 환자 상세 조회 끝 =================================================-->

	<!-- ================================= 치료일정/vital 시작 =================================================-->
	<div class="col-4">

		<div class="card border border-secondary" style="height: 375px;">
			<div class="">
				<input
					class="fw-semi-bold col-7 text-white text-center form-control"
					id="" name="" type="text" value="치료 일정"
					style="background-color: midnightblue" disabled />
			</div>
			<form action="/mediform/" method="post" id="dateForm">
				<input style="float: right; margin-right: 20px; margin-top: 10px;"
					type="date" name="selectDate" value="" id="dateInput" />
				<!-- 					<sec:csrfInput/> -->
			</form>
			<div class="card-body">
				<div class="table-container"
					style="overflow-y: auto; max-height: 300px;">
					<div class="table-container"
						style="overflow-y: auto; max-height: 250px;">
						<table class="table table-sm table-striped" style="height: 90px;">
							<thead>
								<tr id="" class="bg-light">
									<th class="col-1 " scope="col">차트번호</th>
									<th class="col-1 " scope="col">치료</th>
									<th class="col-1 " scope="col">치료사</th>
									<th class="col-1 " scope="col">치료시간</th>
									<th class="col-1 " scope="col">상태</th>
								</tr>
							</thead>
							<tbody style="overflow-y: auto; max-height: 90px;"
								id="reservationListTable">
								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>
								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>
								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>
								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>
								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>
								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>
								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>
								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>
								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>
								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>
								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>
								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>
								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>

								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>
								<tr id="">
									<td>T01111142</td>
									<td>물리치료</td>
									<td>임찬빈</td>
									<td>2023/07/10 12:30</td>
									<td>치료완료</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>


				<div class="table-responsive scrollbar mx-nx1 mt-3"></div>
			</div>
		</div>

		<div class="card border border-secondary" style="height: 375px;">
			<div class="">
				<input
					class="fw-semi-bold col-7 text-white text-center form-control"
					id="" name="" type="text" value="Vital"
					style="background-color: midnightblue" disabled />
			</div>

			<div class="card-body" style="padding: 5px;">
				<br> &emsp;&emsp;<span class="badge badge-subtle-success">체온</span>
				&emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp;
				&emsp; &emsp; &emsp; <span class="badge badge-subtle-danger">혈압</span>
				<br>
				<div
					style="display: flex; justify-content: space-between; align-items: center;">
					<br> <br>
					<div class="row g-3 mb-3">
						<!-- 체온 bar chart -->
						<div class="col-6">
							<canvas id="tempChart" height="200"></canvas>
						</div>
						<!-- 혈압 line chart -->
						<div class="col-6">
							<canvas id="pressChart" height="200"></canvas>
						</div>
					</div>

				</div>
				<div class="table-responsive scrollbar mx-nx1 mt-3"></div>
			</div>
		</div>
	</div>
	<!-- ================================= 치료일정/vital 끝 =================================================-->

	<!-- ================================= 환자 검사, 식이/I,O 시작 =================================================-->


	<div class="col-3">
		<div class="card border border-secondary" style="height: 375px;">
			<div class="">
				<input
					class="fw-semi-bold col-7 text-white text-center form-control"
					id="" name="" type="text" value="검사결과"
					style="background-color: midnightblue" disabled />
			</div>

			<div class="card-body">
				<div class="table-container"
					style="overflow-y: auto; max-height: 300px;">
					<div class="table-container"
						style="overflow-y: auto; max-height: 300px;">
						<table class="table table-sm table-striped" style="height: 90px;">
							<thead>
								<tr id="" class="bg-light">
									<th class="col-1 " scope="col">날짜</th>
									<th class="col-1 " scope="col">채혈</th>
									<th class="col-1 " scope="col">소변</th>
									<th class="col-1 " scope="col">X-RAY</th>
								</tr>
							</thead>
							<tbody style="overflow-y: auto; max-height: 90px;"
								id="reservationListTable">
								<tr id="">
									<td>2023/04/01</td>
									<td>정상</td>
									<td>정상</td>
									<td><a href="#">결과보기</a></td>
								</tr>

							</tbody>
						</table>
					</div>
				</div>

				<div
					style="display: flex; justify-content: space-between; align-items: center;">
				</div>
				<div class="table-responsive scrollbar mx-nx1 mt-3"></div>
			</div>
		</div>
		<!-- 식이 & I/O 시작 -->

		<div class="card border border-secondary" style="height: 375px;">
			<div class="">
				<input
					class="fw-semi-bold col-7 text-white text-center form-control"
					id="" name="" type="text" value="식이  &  I/O"
					style="background-color: midnightblue" disabled />
			</div>
			<ul class="nav nav-tabs" id="myTab" role="tablist">
				<li class="nav-item col-6"><a class="nav-link active"
					id="home-tab" data-bs-toggle="tab" href="#tab-home" role="tab"
					aria-controls="tab-home" aria-selected="true">식이</a></li>
				<li class="nav-item col-6"><a class="nav-link" id="profile-tab"
					data-bs-toggle="tab" href="#tab-profile" role="tab"
					aria-controls="tab-profile" aria-selected="false">I/O</a></li>
			</ul>
			<!--식이 탭 시작  -->
			<div class="tab-content border border-0 p-0" id="myTabContent">
				<!-- TAB1 -->
				<div class="tab-pane fade show active" id="tab-home" role="tabpanel"
					aria-labelledby="home-tab">
					<button class="btn btn-outline-warning me-1 mb-1" type="button"
						id="meal" style="margin-top: 5px; margin-left: 10px;">식이
						작성</button>

					<div class="card-body" style="padding-top: 5px;">
						<div class="table-container"
							style="overflow-y: auto; max-height: 300px;">
							<div class="table-container"
								style="overflow-y: auto; max-height: 240px;">
								<table class="table table-sm table-striped"
									style="height: 90px;">
									<thead>
										<tr id="" class="bg-light">
											<th class="col-1 " scope="col">날짜</th>
											<th class="col-1 " scope="col">식이코드</th>
											<th class="col-1 " scope="col">식이명</th>
											<th class="col-1 " scope="col">시간</th>
										</tr>
									</thead>
									<tbody style="overflow-y: auto; max-height: 90px;"
										id="reservationListTable">
										<tr id="">
											<td>2023/10/18</td>
											<td>DD0012</td>
											<td>일반식 R/D</td>
											<td>저녁</td>
										</tr>
										<tr id="">
											<td>2023/10/18</td>
											<td>DD0012</td>
											<td>일반식 R/D</td>
											<td>저녁</td>
										</tr>
										<tr id="">
											<td>2023/10/18</td>
											<td>DD0012</td>
											<td>일반식 R/D</td>
											<td>저녁</td>
										</tr>
										<tr id="">
											<td>2023/10/18</td>
											<td>DD0012</td>
											<td>일반식 R/D</td>
											<td>저녁</td>
										</tr>
										<tr id="">
											<td>2023/10/18</td>
											<td>DD0012</td>
											<td>일반식 R/D</td>
											<td>저녁</td>
										</tr>
										<tr id="">
											<td>2023/10/18</td>
											<td>DD0012</td>
											<td>일반식 R/D</td>
											<td>저녁</td>
										</tr>
										<tr id="">
											<td>2023/10/18</td>
											<td>DD0012</td>
											<td>일반식 R/D</td>
											<td>저녁</td>
										</tr>
										<tr id="">
											<td>2023/10/18</td>
											<td>DD0012</td>
											<td>일반식 R/D</td>
											<td>저녁</td>
										</tr>
										<tr id="">
											<td>2023/10/18</td>
											<td>DD0012</td>
											<td>일반식 R/D</td>
											<td>저녁</td>
										</tr>
										<tr id="">
											<td>2023/10/18</td>
											<td>DD0012</td>
											<td>일반식 R/D</td>
											<td>저녁</td>
										</tr>

									</tbody>
								</table>
							</div>
						</div>
						<div
							style="display: flex; justify-content: space-between; align-items: center;">
						</div>
						<div class="table-responsive scrollbar mx-nx1 mt-3"></div>
					</div>
				</div>
				<!-- TAB2 -->
				<!--I/O 탭 시작  -->
				<div class="tab-pane fade" id="tab-profile" role="tabpanel"
					aria-labelledby="profile-tab">
					<button class="btn btn-outline-warning me-1 mb-1" type="button"
						id="io" style="margin-top: 5px; margin-left: 10px;">I/O
						작성</button>

					<div class="card-body" style="padding-top: 5px;">
						<div class="table-container"
							style="overflow-y: auto; max-height: 300px;">
							<div class="table-container"
								style="overflow-y: auto; max-height: 240px;">
								<table class="table table-sm table-striped"
									style="height: 90px;">
									<thead>
										<tr id="" class="bg-light">
											<th class="col-1 " scope="col">시행일자</th>
											<th class="col-1 " scope="col">섭취</th>
											<th class="col-1 " scope="col">섭취 (mL)</th>
											<th class="col-1 " scope="col">배출</th>
											<th class="col-1 " scope="col">배출 (mL)</th>
										</tr>
									</thead>
									<tbody style="overflow-y: auto; max-height: 90px;"
										id="reservationListTable">
										<tr id="">
											<td>2023/04/02 12:00</td>
											<td>일반식</td>
											<td>4000</td>
											<td>소변</td>
											<td>100</td>
										</tr>


									</tbody>
								</table>
							</div>
						</div>
						<div
							style="display: flex; justify-content: space-between; align-items: center;">
						</div>
						<div class="table-responsive scrollbar mx-nx1 mt-3"></div>
					</div>
				</div>
			</div>
		</div>

		<!-- ROW -->
	</div>
	<!-- ================================= 환자 검사,식이/I,O 끝 =================================================-->

	<!-- ================================= 환자 인수인계 시작 =================================================-->
	<div class="col-3">
		<div class="card border border-secondary" style="height: 750px;">
			<div class="">
				<input
					class="fw-semi-bold col-7 text-white text-center form-control"
					id="" name="" type="text" value="환자 인수인계"
					style="background-color: midnightblue" disabled />
			</div>
			<div class="h-100 overflow-auto scrollbar">
				<div class="timeline-vertical" id="jyList"
					style="width: 90%; padding-left: 30px;">
					<!-- 여기안에다 ajax 출력하는 곳 -->
				</div>
			</div>

			<form class="chat-editor-area" style="height: 70px;">
				<input type="hidden" name="nrsRcordCd" id="nrsRcordCd">
				<div class="emojiarea-editor outline-none scrollbar" id="nrsRcordCn"
					contenteditable="true" contenteditable="true" style="height: 100%;"></div>
				<!--text area  -->
				<div class="btn btn-link emoji-icon" data-picmo="data-picmo"
					data-picmo-input-target=".emojiarea-editor">
					<span class="far fa-laugh-beam"></span>
				</div>
				<button class="btn btn-sm btn-send shadow-none" id="takeOverBtn"
					type="button">Send</button>
			</form>

		</div>
	</div>
	<!-- ================================= 환자 인수인계 끝 =================================================-->


	<!-- ================================= 식이 모달 창 시작  =================================================-->

	<div class="modal fade" id="mealEventModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content border">

				<form action="/mediform/" id=" EventForm" method="post">
					<div class="modal-header px-x1 bg-body-tertiary border-bottom-0">
						<h5 class="modal-title">식이 기록지</h5>
						<button class="btn-close me-n1" type="button"
							data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="px-x1 border-bottom-0">
						<input type="hidden" name="" id="">
						<!-- 식이 코드 -->

						<div class="mb-3">
							<label class="fs-0" for="eventLabel">식이 명</label> <select
								class="form-select" id="" name="">
								<option value="RD" selected="selected">일반식[R/D]</option>
								<option value="TD">허용식 [T/D]</option>
								<option value="SD">연식 [S/D]</option>
								<option value="LD">유동식 [L/D]</option>
								<option value="SOW">물 [SOW]</option>
								<option value="NPO">금식 [NPO]</option>
							</select>
						</div>
						<div class="mb-3">
							<label class="fs-0" for="eventStartDate">섭취일</label> <input
								class="form-control datetimepicker" id="" name=""
								required="required" type="text" placeholder="yyyy/mm/dd hh:mm"
								data-options='{"static":"true","enableTime":"true","dateFormat":"Y-m-d H:i"}' />
						</div>
						<div class="mb-3">
							<label class="fs-0" for="eventLabel">섭취 시간</label> <select
								class="form-select" id="" name="">
								<option value="bkft" selected="selected">아침</option>
								<option value="lanch">점심</option>
								<option value="dinner">저녁</option>
							</select>
						</div>
					</div>
					<div
						class="modal-footer d-flex justify-content-end align-items-center bg-body-tertiary border-0">
						<button class="btn btn-primary px-4" id="eventBtn">Save</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	<!-- ================================= 식이 모달 창 끝  =================================================-->

	<!-- ================================= I/O 모달 창 시작  =================================================-->

	<div class="modal fade" id="ioEventModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content border">
				<div class="modal-header px-x1 bg-body-tertiary border-bottom-0">
					<h5 class="modal-title">I/O 기록지</h5>
					<button class="btn-close me-n1" type="button"
						data-bs-dismiss="modal" aria-label="Close"></button>
				</div>

				<form action="/mediform/scheduler/main" id="addEventForm"
					method="post">
					<div class="px-x1 border-bottom-0">
						<input type="hidden" name="" id="">
						<!-- I/O 코드 -->
						<div class="modal-body p-x1">
							<div class="mb-3">
								<label class="fs-0" for="eventStartDate">작성 시간</label> <input
									class="form-control datetimepicker" id="" name=""
									required="required" type="text" placeholder="yyyy/mm/dd hh:mm"
									data-options='{"static":"true","enableTime":"true","dateFormat":"Y-m-d H:i"}' />
							</div>
							<div class="modal-body p-x1">
								<div class="mb-3">
									<label class="fs-0" for="eventTitle">섭취 내용</label> <input
										class="form-control" type="text" name="" id=""
										required="required" />
								</div>
							</div>
							<div class="modal-body p-x1">
								<div class="mb-3">
									<label class="fs-0" for="eventTitle">섭취 용량 (mL)</label> <input
										class="form-control" type="number" name="" id=""
										required="required" />
								</div>
							</div>
							<div class="mb-3">
								<label class="fs-0" for="eventLabel">배설 내용</label> <select
									class="form-select" id="" name="">
									<option value="UO" selected="selected">소변</option>
									<option value="VOM">구토</option>
									<option value="DIA">설사</option>
									<option value="SO">대변</option>
								</select>
							</div>
							<div class="modal-body p-x1">
								<div class="mb-3">
									<label class="fs-0" for="eventTitle">배설 용량 (mL)</label> <input
										class="form-control" type="number" name="" id=""
										required="required" />
								</div>
							</div>
						</div>
						<div
							class="modal-footer d-flex justify-content-end align-items-center bg-body-tertiary border-0">
							<button class="btn btn-primary px-4" id="eventBtn">Save</button>
						</div>
				</form>
			</div>
		</div>
	</div>
</div>

<!-- ================================= I/O 모달 창 끝  =================================================-->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script
	src="https://cdn.jsdelivr.net/jsbarcode/3.3.20/JsBarcode.all.min.js"></script>
<script type="text/javascript"
	src="/resources/assets/js/nurse/barcode.js"></script>

<script type="text/javascript">
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");
			var takeOverBtn = $("#takeOverBtn");
			var empNm = $("#empNm").val();
			
			/* ----환자조회--- */
			$(function () {

				// 검색 input요소
				var searchInput = $("#searchInput");
				// 드롭다운 요소(결과를 뿌려줄 곳)
				var searchRes = $("#search-results");
				// 환자 정보를 담을 테이블
				var patientTable = $("#patientTable");
				console.log(patientTable);
				let selectedIndex = -1;

				searchInput.focusin(function () {
					console.log("searchInput...!");
					if (searchInput.val() == "") {
						console.log("searchInput.val() : " + searchInput.val());
						$.ajax({
							type: "post",
							url: "/mediform/patient/HsptlzInfo",
							contentType: "application/json; charset=utf-8",
							beforeSend: function (xhr) {
								//ajax호출 중 처리
								//글로벌 변수로 설정한 csrf token 셋팅
								xhr.setRequestHeader(header, token);
							},
							success: function (res) {
								var searchResultsHtml = "";
								console.log(res.length);
								$(res).each(function () {
									console.log(this.patntNm + " " + this.patntAge);
									searchResultsHtml += '<div class="dropdown-item px-x1 py-2" data-no="' + this.patntNo + '" data-name="' + this.patntNm + '">';
									searchResultsHtml += '<div class="d-flex align-items-center">';
									searchResultsHtml += '<div class="flex-1">';
									searchResultsHtml += ' <h6 class="mb-0 title pointer">' + this.patntNo + '  |  ' + this.patntNm + '  |  ' + this.patntAge + '세  |  ' + this.patntRrno1 + '</h6>';
									searchResultsHtml += '</div>';
									searchResultsHtml += '</div>';
									searchResultsHtml += '</div>';
								});
								$(searchRes).html(searchResultsHtml);
							},
							error: function (err) {
								console.log("환자 조회>>>err에러 : " + err);
							}
						});
					}
				});

				// 환자 검색 시 키보드를 한글자씩 눌렀다가 떼는 순간 이벤트 발생
				searchInput.on("keyup", function () {

					var keyword = searchInput.val();
					console.log("keyword : " + keyword);
					var searchObj = {
						keyword: keyword
					};

					// 검색 환자 정보
					$.ajax({
						type: "post",
						url: "/mediform/patient/hsptlzSearch",
						data: JSON.stringify(searchObj),
						contentType: "application/json; charset=utf-8",
						beforeSend: function (xhr) {
							//ajax호출 중 처리
							//글로벌 변수로 설정한 csrf token 셋팅
							xhr.setRequestHeader(header, token);
						},
						success: function (res) {
							var searchResultsHtml = "";
							console.log(res.length);
							// 받아온 데이터가 없을 때 
							// 환자 정보 없음은 h5로 설정(h6로 설정 시 클릭하면 환자 정보 테이블에 들어가지기 때문)
							if (res.length == 0) {
								console.log("받아온 데이터 없음");
								searchResultsHtml += '<div class="dropdown-item px-x1 py-2">';
								searchResultsHtml += '<div class="d-flex align-items-center">';
								searchResultsHtml += '<div class="flex-1">';
								searchResultsHtml += '<h5 class="mb-0 title">환자 정보가 존재하지 않습니다.</h5>';
								searchResultsHtml += '</div>';
								searchResultsHtml += '</div>';
								searchResultsHtml += '</div>';
							} else {
								// 받아온 값을 뿌리는 역할
								$(res).each(function () {
									console.log(this.patntNm + " " + this.patntAge);
									searchResultsHtml += '<div class="dropdown-item px-x1 py-2" data-no="' + this.patntNo + '" data-name="' + this.patntNm + '">';
									searchResultsHtml += '<div class="d-flex align-items-center">';
									searchResultsHtml += '<div class="flex-1">';
									searchResultsHtml += ' <h6 class="mb-0 title pointer">' + this.patntNo + '  |  ' + this.patntNm + '  |  ' + this.patntAge + '세  |  ' + this.patntRrno1 + '</h6>';
									searchResultsHtml += '</div>';
									searchResultsHtml += '</div>';
									searchResultsHtml += '</div>';
								});
							}
							$(searchRes).html(searchResultsHtml);
						},
						error: function (err) {
							console.log("환자 검색 >>err에러 : " + err);
						}
					});
				});

				$("#searchInput").keypress(function (event) {
					if (event.which == 13) {
						event.preventDefault();
						var patntNo = searchRes.children("div:eq(0)").data("no");
						var patntNm = searchRes.children("div:eq(0)").data("name");
						console.log(patntNo);
						// input태그에 선택된 이름 넣어주기
						$(searchInput).val(patntNm);
						// 환자 조회
						selectPatientAjax(patntNo);


						searchInput.blur();
						$(".hideOnOff").hide();
					}
				});


				// 위에서 뿌려준 환자 정보를 클릭시 (드롭다운 div 안에 있는 <h6>태그 요소를 전부 가져와 클릭 이벤트 발생 시 작동)
				$(searchRes).on("click", "h6", function (event) {


					// 클릭된 h6 태그
					var clickTarget = $(event.target);

					// h6 태그 안에 있는 환자 정보 텍스트
					var patientInfo = clickTarget.text();
					console.log(clickTarget.text());

					// 환자 정보 텍스트를 공백 기준으로 나누기
					var patientSplit = patientInfo.split(' ');
					console.log(patientSplit);

					// 환자 번호(환자 정보 텍스트를 공백 기준으로 나누고 나서 0번째 요소)
					var patntNo = patientSplit[0];
					var patntNm = patientSplit[4];
					var patntRrno1 = patientSplit[12];
					console.log("환자번호임당 : " + patntNo + " | 환자이름임당 : " + patntNm + " | 환자 주민앞자리 : " + patntRrno1);
					var patientObj = {
						patntNo: patntNo,
						patntNm: patntNm,
						patntRrno1: patntRrno1
					};
					//환자 detail
					selectPatientAjax(patntNo, patntNm, patntRrno1);
					//환자 take over list
					selectTakeOverAjax(patntNo);
					//환자 tale over insert
					insertTakeOverAjax(patntNo);

				});
			});

			///////////////////////////////////////////////////////////////
			
			
		function selectPatientAjax(patntNo, patntNm, patntRrno1) {

				// 환자 정보 ajax 시작
				$.ajax({
					type: "post",
					url: "/mediform/nurse/room/patientHospital/list",
					data: { "patntNo": patntNo },
					//contentType : "application/json; charset=utf-8",
					beforeSend: function (xhr) {
						xhr.setRequestHeader(header, token);
					},
					success: function (res) {

						console.log("환자번호::::::::::::: : " + patntNo + " | 환자이름::::::::::::: : " + patntNm + " | 환자 주민앞자리 ::::::::::::: " + patntRrno1);
						$("#clnicNo").val(res.clnicNo);
						$("#patntNm").val(patntNm);
						$("#patntRrno1").val(patntRrno1);
						$("#empNm").val(res.empNm);
						$("#hsptlzDe").val(res.hsptlzDe);
						$("#realLhstl").val(res.realLhstl);
						$("#hsptlzSckrm").val(res.hsptlzSckrm);
						$("#hsptlzSckbd").val(res.hsptlzSckbd);

					},
					error: function (err) {
						console.log("환자 정보>>>err에러 : " + err);
					}
				});
		}
			/* ----환자조회 끝--- */

			//////////////////////////////////////////////////////////////////
			
			/*----환자 인수인계--- */
		function selectTakeOverAjax(patntNo) {
	    
				
				console.log("인수인계 patntNo>>>>>>>>", patntNo);

				$.ajax({
					type: "post",
					url: "/mediform/nurse/room/takeOver/list",
					data: JSON.stringify({ "patntNo": patntNo }),
					contentType: "application/json",
					beforeSend: function (xhr) {
						xhr.setRequestHeader(header, token);
					},
					success: function (dataList) {
						console.log("TOdataList::::::", dataList);

						let htmlStr = "";
						for (let i = 0; i < dataList.length; i++) {
							
							let to = dataList[i];
							
					      var dateString = to.nrsRcordDe;
		                  var date = new Date(dateString);
		                  var year = date.getFullYear();
		                  var month = (date.getMonth() + 1).toString().padStart(2, '0'); // 월은 0부터 시작하므로 +1 해주고 2자리로 포맷팅
		                  var day = date.getDate().toString().padStart(2, '0'); // 일도 2자리로 포맷팅
						  var hour = date.getHours().toString().padStart(2, '0');
						  var minute = date.getMinutes().toString().padStart(2, '0');
		                  
			                  // 원하는 형식으로 조합
			                  var formattedDate = month + '.' + day +" " +hour+":"+minute;
							
							if(to.nrsRcordWrter == empNm){
								htmlStr += `
						<div class="timeline-item timeline-item-start"> <!-- 로그인자가 쓴것 -->
								`;
							}else{
								htmlStr += `
						<div class="timeline-item timeline-item-end"> <!-- 다른 간호사가 쓴것 -->
								`;
							}
							htmlStr += `
								<div
									class="timeline-icon icon-item icon-item-lg text-primary border-300">
									<span class="fs-1 fas fa-mobile"></span>
								</div>
								<div class="row">
									<div class="col-lg-6 timeline-item-time">
										<div>
										
											<div class="fs--1 mb-0 fw-semi-bold">`+year+`</div>
											<div class="fs--2 text-600">`+formattedDate+`</div>
										</div>
									</div>
									<div class="col-lg-6">
										<div class="timeline-item-content">
											<div class="timeline-item-card">
												<h5 class="mb-2">\${to.nrsRcordWrter} </h5><h6>간호사</h6>
												<p class="fs--1 mb-0">\${to.nrsRcordCn}</p>
											</div>
										</div>
									</div>
								</div>
							</div>
									`;
						}
						$("#jyList").html(htmlStr);  // 화면에 html넣기
					},
					error: function (err) {
						console.log("인수인계 >>err에러 : " + err);
					}
				});
		}	
				
		function insertTakeOverAjax(patntNo) {
	
			 takeOverBtn.on("click", function() {
					var nrsRcordCn = document.getElementById('nrsRcordCn').innerHTML;
					var nrsRcordCd = $("#nrsRcordCd").val();
					
					var takeOverObj = {
							nrsRcordCd : nrsRcordCd,
							patntNo : patntNo,
							nrsRcordWrter : empNm,
							nrsRcordCn : nrsRcordCn
					}
					console.log("patentno::::>>>",patntNo);
					
					$.ajax({
	                     type : "post",
	                     url : "/mediform/nurse/room/takeOver/insert",
	                     data : JSON.stringify(takeOverObj),
	                     contentType : "application/json; charset = utf-8",
	                       beforeSend : function(xhr){            
	                        	xhr.setRequestHeader(header,token);
	                       },
	                     success: function(result) {
	                        console.log("result:"+ result);
	                        alert("인수인계 작성이 완료하였습니다.");
// 	                        location.href = "/mediform/nurse/medicine/list/select";
	                        selectTakeOverAjax(patntNo);
	                        $("#nrsRcordCn").html("");
	                     },
	                     error : function(err) {
	                        alert(err,"실패!!");
	                     }
	                  });
				});	
		}		
/* ----환자 인수인계 끝--- */

/* ----환자 식이 , I/O 시작--- */
		function name() {
			
	
		}
/* ----환자 식이 , I/O 끝--- */

/* ----식이, I/O 모달 창 & insert--- */
			var meal = $("#meal");
			var io = $("#io");
			var mealEventModal = $("#mealEventModal");
			var ioEventModal = $("#ioEventModal");

			//식이, I/O 모달 창 클릭 시 실행
			meal.on("click", function () {

				console.log("식이 모달 클릭 이벤트 성공!!!");
				mealEventModal.modal("show");

				// 		// 클릭한 병상 번호 변수에 담기
				// 		var bedNo = $(this).attr("id");

				// 		// 병상번호 출력
				// 		console.log("선택한 환자가 있는 병상번호 : " + bedNo);

			});

			io.on("click", function () {

				console.log("I/O 모달 클릭 이벤트 성공!!!");
				ioEventModal.modal("show");

			});
			/* ----식이, I/O 모달 창 & insert끝--- */

			/* ----chart ---- */

			//bar chart
			const tempCtx = document.getElementById('tempChart');

			let tempChart = new Chart(tempCtx,
				{
					type: 'bar',
					data: {
						labels: ['체온', 'Blue', 'Yellow', 'Green', 'Purple',
							'Orange'],
						datasets: [{
							label: '# 체온',
							data: [12, 19, 3, 5, 2, 3],
							borderWidth: 1
						}]
					},
					options: {
						scales: {
							y: {
								beginAtZero: true
							}
						}
					}
				});

			//line chart
			const pressCtx = document.getElementById('pressChart');

			let pressChart = new Chart(pressCtx,
				{
					type: 'line',
					data: {
						labels: ['체온', 'Blue', 'Yellow', 'Green', 'Purple',
							'Orange'],
						datasets: [{
							label: '# 혈압',
							data: [12, 19, 3, 5, 2, 3],
							borderWidth: 1
						}]
					},
					options: {
						scales: {
							y: {
								beginAtZero: true
							}
						}
					}
				});
			/* ----chart 끝--- */
		</script>